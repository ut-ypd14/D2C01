<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<script src="./config.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RAW 檢視（不排序不篩選不分組）</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:8px}
  #status{margin:8px 0}
  table{border-collapse:collapse;width:100%;font-size:14px}
  th,td{border:1px solid #ddd;padding:4px;text-align:center;white-space:nowrap}
  thead th{background:#f3f4f6}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
</style>
</head>
<body>
<div id="status" class="mono">fetching…</div>
<div id="root"></div>

<script>
async function loadRaw(){
  const status = document.getElementById('status');
  const root = document.getElementById('root');
  try{
    const res = await fetch(api_url, { method:"POST", body:new URLSearchParams({action:"list_recent"}) });
    if (!res.ok) throw new Error("HTTP " + res.status + " " + res.statusText);
    const data = await res.json();
    if (data?.status !== "ok" || !Array.isArray(data.fields) || !Array.isArray(data.values)){
      throw new Error("bad payload");
    }
    status.textContent = "OK (" + data.values.length + " rows)";
    const F = data.fields;
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const trh = document.createElement('tr');
    trh.innerHTML = "<th>#</th>" + F.map(h => "<th>"+h+"</th>").join("");
    thead.appendChild(trh);
    table.appendChild(thead);
    const tbody = document.createElement('tbody');
    data.values.forEach((row, i) => {
      const tr = document.createElement('tr');
      let tds = "<td class='mono'>"+(i+1)+"</td>";
      for (let c=0; c<F.length; c++){
        let v = row[c];
        if (v === undefined || v === null) v = "";
        tds += "<td class='mono'>" + String(v) + "</td>";
      }
      tr.innerHTML = tds;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    root.innerHTML = "";
    root.appendChild(table);
  }catch(e){
    status.textContent = "ERROR: " + (e && e.message ? e.message : String(e));
  }
}

document.addEventListener('DOMContentLoaded', loadRaw);
</script>
</body>
</html>
